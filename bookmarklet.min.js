/*! XPorterCodeEditorBookmarklet - v0.1.0 - 2015-10-23
* Copyright (c) 2015 Colin Brogan; */
function loadScript(a,b){var c=document.createElement("script");c.type="text/javascript",c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&(c.onreadystatechange=null,b())}:c.onload=function(){b()},c.src=a,document.getElementsByTagName("head")[0].appendChild(c)}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return!1}function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString(),f="path=/";document.cookie=a+"="+b+"; "+e+";"+f+";"}loadScript("https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.0/ace.js",function(){console.log("ace loaded");var a=$(["<div id='advanced-editor-wrap' style='position:fixed; bottom: 0; right: 0; background: black; color: white; width: 100%; display: inline-block;'>",'<a href="#" id="toggle-pane" style="float: right; font-size: 20px; margin-right: 1rem; color: white; font-weight: 900;">-</a>','<div id="advanced-editor" style="width: 100%; height: 10rem;" />',"</div>"].join(""));$("body").append(a);var b=ace.edit("advanced-editor");b.setTheme("ace/theme/monokai"),b.getSession().setMode("ace/mode/html"),$("#toggle-pane").click(function(){$(this).toggleClass("open"),$(this).hasClass("open")?($(this).text("-"),$("#advanced-editor").css("height","10rem")):($(this).text("+"),$("#advanced-editor").css("height","0rem"))}),$('input[name="liquid-value"]').focus(function(){var c=$(this).attr("id");$("#edit-title").remove(),$("toggle-pane").after("<strong id='edit-title'>Editing "+c+"</strong>"),a.data("changing",c),b.getSession().on("change",function(c){for(var d=a.data("changing"),e="",f=b.getValue(),g=f.indexOf("\n");g>=0;)e+=g+"-",g=f.indexOf("\n",g+1);console.log('setCookie("lb_map_#"'+d+","+e+",365);"),setCookie("lb_map_#"+d,e,365);var h=f.replace(/\n/g,"");$("#"+d).val(h)});var d=getCookie("lb_map_#"+c),e=$(this).val();if(console.log("lb_map"),console.log(d),d){var f=d.split("-");for(var g in f)if(Number(f[g])>0){var h=Number(f[g]);Number(f[g])+Number(g)+1;console.log("Attempted to add lb at "+Number(f[g])+" on i "+g),e=e.slice(0,h)+"\n"+e.slice(h),console.log("new_contents.slice(0, "+h+") + '\n' + new_contents.slice("+h+");"),console.log(e)}}b.setValue(e)})});